---
slug: project
title: project
---

_note: parts of this page are taken from kostis christodoulou and the study group 10_

```{r load-libraries, echo=F, message=F, warning=F}
library(tidyverse)
library(tidyquant)
library(knitr)
library(here)
library(ggrepel)
```

```{r, setup, echo=F}
options(digits=3)
opts_chunk$set(
  message=F,
  warning=F,
  tidy=F,
  size='small',
  fig.width=6.75,
  fig.height=6.75,
  fig.align='center')
```

firstly, we load a dataset `nyse.csv` containing 508 stocks listed on the `nyse`, their unique ticker `symbol` and `name`, the `ipo_year` (initial public offering), as well as the `sector` and `industry` the company is in.

```{r load-data, echo=F, message=F, warning=F}
nyse <- read_csv(here('static/data', 'nyse.csv'))
glimpse(nyse)
```

based on this dataset, we create a bar plot that shows the number of companies per sector in descending order.

```{r companies-per-sector, echo=F}
nyse %>%
  group_by(sector) %>%
  count(sort=T) %>%
  ggplot(aes(x=n, y=fct_reorder(sector, n))) +
  geom_col() +
  theme_bw() +
  labs(title='number of stocks across sectors', x='number of stocks', y='sector') +
  NULL
```

next, let's choose some stocks and download some their historical prices using the `tidyquant` package. recall that the column `symbol` can be used to uniquely represent a single stock or index.

```{r isolate-stocks, echo=F, message=F, warning=F, cache=T}
stocks <- c('AAPL', 'JPM', 'DIS', 'DPZ', 'ANF', 'SPY') %>%
  tq_get(get='stock.prices',
         from='2011-01-01',
         to='2021-08-31') %>%
  group_by(symbol)

glimpse(stocks)
```

financial performance analysis depend on returns; if we buy a stock today for 100 and we sell it tomorrow for 101.75, our one-day return, assuming no transaction costs, is 1.75%. so given the adjusted closing prices, our first step is to calculate monthly returns.

```{r calculate-returns, echo=F, message=F, warning=F, cache=T}
stocks_returns_monthly <- stocks %>%
  tq_transmute(select=adjusted,
               mutate_fun=periodReturn,
               period='monthly',
               type='arithmetic',
               col_rename='monthly_returns',
               cols=c(nested.col))
```

now we create a table where we summarise monthly returns for each of the stocks and `spy` index.

```{r summarise-monthly-returns, echo=F}
stocks_returns_monthly %>%
  group_by(symbol) %>%
  summarise(
    min=min(monthly_returns),
    max=max(monthly_returns),
    median=median(monthly_returns),
    mean=mean(monthly_returns),
    sd=sd(monthly_returns))
```

next, for each of the stocks we make a density plot, using `geom_density()`.

```{r density-monthly-returns, echo=F}
stocks_returns_monthly %>%
  ggplot(aes(x=monthly_returns, colour=symbol, fill=symbol)) +
  geom_density(alpha=0.3) +
  facet_wrap(~symbol) +
  theme_bw() +
  theme(legend.position='none') +
  labs(title='density plot of monthly returns', x='return', y='density') +
  NULL
```

what can we infer from this plot? which stock is the riskiest and which one is the the least risky?

plotting the monthly returns for the stocks of various companies over time helps us determine the level of risk involved in such investments. according to the density plot, the riskiest stock is `anf` and the least risk is involved in `spy`.

finally, make a plot that shows the expected monthly return (mean) of a stock on the y axis and the risk (standard deviation) in the x-axis.

```{r plot-risk-return, echo=F}
stocks_returns_monthly %>%
  group_by(symbol) %>%
  summarise(
    sd=sd(monthly_returns),
    mean=mean(monthly_returns)) %>%
  ggplot(aes(x=sd, y=mean, label=symbol)) +
  geom_point() +
  theme_bw() +
  geom_text_repel() +
  labs(title='risk and return plot for selected stocks', x='risk', y='return') +
  NULL
```

what can we infer from this plot? are there any stocks which, while being riskier, do not have a higher expected return?

this plot depicts the risk-return relationship of each stock. while `dpz` provides the highest return for a moderate risk level, `anz` despite being the riskiest provides the least amount of return.

for in-depth explanations, take a look at [these finance data sources](https://mam2022.netlify.app/reference/finance_data).